#include <stdio.h>
#include <stdlib.h>
#include <string.h>

typedef struct {
    char matricola[10];
    char name[30];
    int score;
}student;


// Function Prototype
int readStudents(student *studentlist, int n, char name[]);
int selectStudents(student list[], int n, student* listRef[], int th);
void printResults(student *listRef[], int n, char *outputFile);

// Main function

int main(void){
    student listStudents[100], *selStudents[100];
    int i, n = readStudents(listStudents, 100, "../input.txt");

    int threshold = 18;
    int nSuff = selectStudents(listStudents, n, selStudents, threshold);

    printResults(selStudents,nSuff,"../output.txt");

    exit(EXIT_SUCCESS);
}
// Function declarations
int readStudents(student *studentlist, int n, char name[]) {
    FILE *fp = fopen(name,"r");
    int i;
    if(fp == NULL){
        fprintf(stdout,"Error opening file");
        exit(EXIT_FAILURE);
    }

    i = 0;
    while(fscanf(fp,"%s %s %d", studentlist[i].matricola, studentlist[i].name, &studentlist[i].score)!=EOF){
        i++;
    }

    fclose(fp);
    return i;
}

int selectStudents(student list[], int n, student* listRef[], int th){
    int count, i;


    count = 0;
    for(i=0;i<n; i++){
        if(list[i].score >= th){
            listRef[count++] = &list[i];
        }
    }

    return count;
}

void printResults(student *listRef[], int n, char *outputFile){
    FILE *fp = fopen(outputFile,"w");
    int i;
    if(fp == NULL){
        fprintf(stdout,"Error opening the file");
        exit(EXIT_FAILURE);
    }
    for(i=0;i<n;i++){
        fprintf(fp,"%7d %d\n", atoi(listRef[i]->matricola) + 100, listRef[i]->score);
    }

    fclose(fp);
}
